"use strict";var national_holiday=[{title:"新年",start:moment("2016-02-08"),className:"national"},{title:"新年",start:moment("2016-02-09"),className:"national"},{title:"新年",start:moment("2016-02-10"),className:"national"},{title:"新年",start:moment("2016-02-11"),className:"national"},{title:"新年",start:moment("2016-02-12"),className:"national"},{title:"二二八補假",start:moment("2016-02-29"),className:"national"},{title:"清明節",start:moment("2016-04-04"),className:"national"},{title:"兒童節補假",start:moment("2016-04-05"),className:"national"},{title:"端午節",start:moment("2016-06-09"),className:"national"},{title:"彈性放假",start:moment("2016-06-10"),className:"national"},{title:"中秋節",start:moment("2016-09-15"),className:"national"},{title:"彈性放假",start:moment("2016-09-16"),className:"national"},{title:"雙十節",start:moment("2016-10-10"),className:"national"},{title:"元旦補假",start:moment("2017-01-02"),className:"national"},{title:"新年",start:moment("2017-01-27"),className:"national"},{title:"新年",start:moment("2017-01-28"),className:"national"},{title:"新年",start:moment("2017-01-29"),className:"national"},{title:"新年",start:moment("2017-01-30"),className:"national"},{title:"新年",start:moment("2017-01-31"),className:"national"},{title:"新年",start:moment("2017-02-01"),className:"national"},{title:"彈性放假",start:moment("2017-02-27"),className:"national"},{title:"二二八",start:moment("2017-02-28"),className:"national"},{title:"彈性放假",start:moment("2017-04-03"),className:"national"},{title:"兒童節",start:moment("2017-04-04"),className:"national"},{title:"清明節",start:moment("2017-04-05"),className:"national"},{title:"彈性放假",start:moment("2017-05-29"),className:"national"},{title:"端午節",start:moment("2017-05-30"),className:"national"},{title:"彈性放假",start:moment("2017-10-09"),className:"national"},{title:"雙十節",start:moment("2017-10-10"),className:"national"}],weekend_workday=["2016-06-04","2016-09-10"],eventArray,hourArray,targetEvent,back2workStatus="all-day";$(document).ready(function(){var a=$("#calendar");a.fullCalendar({allDayDefault:!0,eventClick:function(a,t,e){targetEvent=a},eventAfterAllRender:function(a){$.each($(".tenDays"),function(a,t){$(t).children(".fc-content").append('<div class="arrow minus" data-move="minus"></div><div class="arrow plus" data-move="plus"></div><div class="event-background"></div>')}),$(".fc-day-number.fc-sat").each(function(a,t){weekend_workday.indexOf($(t).attr("data-date"))>-1&&!$(t).hasClass("markWork")&&$(t).html('<span class="weekendWork">補班</span> '+parseInt($(t).attr("data-date").substr(-2))).addClass("markWork")})}});new Pikaday({field:$("#datepicker")[0],format:"YYYY-MM-DD"});$(".options").on("click",function(a){$(".options").removeClass("valuable"),$(".wave").removeClass("show"),$(a.currentTarget).addClass("valuable"),$(a.currentTarget).find(".wave").addClass("show"),$(".day-value").text("all-day"==$(a.currentTarget).attr("data-day")?"整天":"半天"),back2workStatus=$(a.currentTarget).attr("data-day")}),$(".ok").on("click",function(){if(""==$("#datepicker").val())alert("跟我說哪天退伍麻~");else{var t=moment($("#datepicker").val());eventArray=[{title:"退伍日",start:t,className:"retireDate"}];var e=t;hourArray=[];for(var n=0;9>n;n++){e=moment(e).add(-10,"days"),e.makeOnWorkDay();var r={title:"*該上勤了吧",start:e,className:"tenDays event-"+n};eventArray.push(r)}a.fullCalendar("removeEvents"),a.fullCalendar("addEventSource",eventArray),a.fullCalendar("addEventSource",national_holiday),setHourArray(),a.fullCalendar("gotoDate",t),$(".overlay").fadeOut(300)}}),a.on("click",".arrow",function(t){t.stopPropagation();var e=parseInt(targetEvent.className[1].substring(6,7))+1,n=$(t.currentTarget).attr("data-move"),r="OK",s=eventArray[e].start;if("minus"==n){var o=moment(eventArray[e-1].start).add(-10,"days");s=1==s.day()?1==meetWeekendWorkDay(moment(s).add(-2,"days"))?moment(s).add(-2,"days"):moment(s).add(-3,"days"):moment(s).add(-1,"days");for(var l=!0;l;){l=!1;for(var i=0;i<national_holiday.length;i++)s.isSame(national_holiday[i].start)&&(s=moment(s).add(-1,"days"),l=!0)}0==s.day()&&(s=moment(s).add(-2,"days")),s.isBefore(o)&&(r="NOT ALLOWED",showDialog("left"))}else s=moment(s).add(1,"days"),s.makeOnWorkDay(),s.isSame(eventArray[e-1].start)&&(r="NOT ALLOWED",showDialog("right"));if("OK"==r){for(var i=e;10>i;i++){var m=eventArray[i].start;m=i==e?s:moment(eventArray[i-1].start).add(-10,"days"),m.makeOnWorkDay(),eventArray[i].start=m}a.fullCalendar("removeEvents"),a.fullCalendar("addEventSource",eventArray),a.fullCalendar("addEventSource",national_holiday),setHourArray()}}),$("#calendar").on("click",".fc-event",function(){for(var a=0,t=1;t<eventArray.length&&targetEvent.start.isSameOrBefore(eventArray[t].start,"day");t++)"half-day"==back2workStatus&&(a+=4);for(var t=0;t<hourArray.length&&targetEvent.start.isSameOrBefore(hourArray[t].start,"day");t++)"8hr"==hourArray[t].title&&(a+=8);$(".need-hours").text(a),showDialog("hour")}),$(".month-btn").on("click",function(t){a.fullCalendar($(t.currentTarget).hasClass("prev")?"prev":"next")}),$(".setting-btn").on("click",function(){$(".overlay").fadeIn(500)})});var showDialog=function(a){$(".alert").addClass("show "+a),$(".dialog").addClass("bounceIn"),$(document).on("keypress",function(a){$(".alert").hasClass("show")&&13==a.keyCode&&$(".dialog .fine").trigger("click")}),$(".dialog .fine").on("click",function(a){$(a.currentTarget).off("click"),$(document).off("keypress"),$(".alert").removeClass("show left right hour"),$(".dialog").removeClass("bounceIn")})},setHourArray=function(){hourArray=[];for(var a=0;a<eventArray.length-1;a++)for(var t=eventArray[a].start,e=eventArray[a+1].start,n=function(a){var e=moment(t).add(-1*a,"days"),n=!1;if(national_holiday.map(function(a){e.isSame(a.start)&&(n=!0)}),0==n){var r={title:0!=e.day()&&6!=e.day()||meetWeekendWorkDay(e)?"8hr":"＊＊＊＊＊",start:e,className:"hourDay"};hourArray.push(r)}},r=1;r<t.diff(e,"days");r++)n(r);$("#calendar").fullCalendar("addEventSource",hourArray)},meetWeekendWorkDay=function(a){return weekend_workday.indexOf(a.format("YYYY-MM-DD"))>-1};Object.assign(moment.prototype,{makeOnWorkDay:function(){0==meetWeekendWorkDay(this)&&(0==this.day()?this.add(1,"days"):6==this.day()&&this.add(2,"days"));for(var a=0;a<national_holiday.length;a++)if(this.isSame(national_holiday[a].start)){this.add(1,"days");break}0==this.isThislegal()&&this.makeOnWorkDay()},isThislegal:function(){if(0==meetWeekendWorkDay(this)&&(0==this.day()||6==this.day()))return!1;for(var a=0;a<national_holiday.length;a++)if(this.isSame(national_holiday[a].start))return!1;return!0}});