function showDialog(a){$(".alert").addClass("show "+a),$(".dialog").addClass("bounceIn"),$(".dialog .fine").on("click",function(){$(".alert").removeClass("show left right hour"),$(".dialog").removeClass("bounceIn"),$(this).off("click")})}function setHourArray(a){for(hourArray=[],i=0;i<eventArray.length-1;i++){var t=eventArray[i].start,e=eventArray[i+1].start;for(j=1;j<t.diff(e,"days");j++){var n=moment(t).add(-1*j,"days"),r=!1;if(national_holiday.map(function(a){n.isSame(a.start)&&(r=!0)}),0==r){var s={title:0!=n.day()&&6!=n.day()||meetWeekendWorkDay(n)?"8hr":"＊＊＊＊＊",start:n,className:"hourDay"};hourArray.push(s)}}}$("#calendar").fullCalendar("addEventSource",hourArray)}function meetWeekendWorkDay(a){return weekend_workday.indexOf(a.format("YYYY-MM-DD"))>-1?!0:!1}var national_holiday=[{title:"新年",start:moment("2016-02-08"),className:"national"},{title:"新年",start:moment("2016-02-09"),className:"national"},{title:"新年",start:moment("2016-02-10"),className:"national"},{title:"新年",start:moment("2016-02-11"),className:"national"},{title:"新年",start:moment("2016-02-12"),className:"national"},{title:"二二八補假",start:moment("2016-02-29"),className:"national"},{title:"清明節",start:moment("2016-04-04"),className:"national"},{title:"兒童節補假",start:moment("2016-04-05"),className:"national"},{title:"端午節",start:moment("2016-06-09"),className:"national"},{title:"彈性放假",start:moment("2016-06-10"),className:"national"},{title:"中秋節",start:moment("2016-09-15"),className:"national"},{title:"彈性放假",start:moment("2016-09-16"),className:"national"},{title:"雙十節",start:moment("2016-10-10"),className:"national"},{title:"元旦補假",start:moment("2017-01-02"),className:"national"},{title:"新年",start:moment("2017-01-27"),className:"national"},{title:"新年",start:moment("2017-01-28"),className:"national"},{title:"新年",start:moment("2017-01-29"),className:"national"},{title:"新年",start:moment("2017-01-30"),className:"national"},{title:"新年",start:moment("2017-01-31"),className:"national"},{title:"新年",start:moment("2017-02-01"),className:"national"},{title:"彈性放假",start:moment("2017-02-27"),className:"national"},{title:"二二八",start:moment("2017-02-28"),className:"national"},{title:"彈性放假",start:moment("2017-04-03"),className:"national"},{title:"兒童節",start:moment("2017-04-04"),className:"national"},{title:"清明節",start:moment("2017-04-05"),className:"national"},{title:"彈性放假",start:moment("2017-05-29"),className:"national"},{title:"端午節",start:moment("2017-05-30"),className:"national"},{title:"彈性放假",start:moment("2017-10-09"),className:"national"},{title:"雙十節",start:moment("2017-10-10"),className:"national"}],weekend_workday=["2016-06-04","2016-09-10"],eventArray,hourArray,targetEvent,back2workStatus="all-day";$(document).ready(function(){var a=$("#calendar");a.fullCalendar({allDayDefault:!0,eventClick:function(a,t,e){targetEvent=a},eventAfterAllRender:function(a){$.each($(".tenDays"),function(){$(this).children(".fc-content").append('<div class="arrow minus" data-move="minus"></div><div class="arrow plus" data-move="plus"></div><div class="event-background"></div>')}),$(".fc-day-number.fc-sat").each(function(){weekend_workday.indexOf($(this).attr("data-date"))>-1&&!$(this).hasClass("markWork")&&$(this).html("<span class='weekendWork'>補班</span> "+parseInt($(this).attr("data-date").substr(-2))).addClass("markWork")})}});new Pikaday({field:$("#datepicker")[0],format:"YYYY-MM-DD"});$(".options").on("click",function(){$(".options").removeClass("valuable"),$(".wave").removeClass("show"),$(this).addClass("valuable"),$(this).find(".wave").addClass("show"),$(".day-value").text("all-day"==$(this).attr("data-day")?"整天":"半天"),back2workStatus=$(this).attr("data-day")}),$(".ok").on("click",function(){if(""==$("#datepicker").val())alert("跟我說哪天退伍麻~");else{var t=moment($("#datepicker").val());eventArray=[{title:"退伍日",start:t,className:"retireDate"}];var e=t;for(hourArray=[],i=0;i<9;i++){moment(e);e=moment(e).add(-10,"days");var n=(e.makeOnWorkDay(),{title:"*該上勤了吧",start:e,className:"tenDays event-"+i});eventArray.push(n)}a.fullCalendar("removeEvents"),a.fullCalendar("addEventSource",eventArray),a.fullCalendar("addEventSource",national_holiday),setHourArray(),a.fullCalendar("gotoDate",t),$(".overlay").fadeOut(300)}}),a.on("click",".arrow",function(t){t.stopPropagation();var e=parseInt(targetEvent.className[1].substring(6,7))+1,n=$(this).attr("data-move"),r="OK",s=eventArray[e].start;if("minus"==n){var l=moment(eventArray[e-1].start).add(-10,"days");s=1==s.day()?1==meetWeekendWorkDay(moment(s).add(-2,"days"))?moment(s).add(-2,"days"):moment(s).add(-3,"days"):moment(s).add(-1,"days");for(var o=!0;o;)for(o=!1,i=0;i<national_holiday.length;i++)s.isSame(national_holiday[i].start)&&(s=moment(s).add(-1,"days"),o=!0);0==s.day()&&(s=moment(s).add(-2,"days")),s.isBefore(l)&&(r="NOT ALLOWED",showDialog("left"))}else s=moment(s).add(1,"days"),s.makeOnWorkDay(),s.isSame(eventArray[e-1].start)&&(r="NOT ALLOWED",showDialog("right"));if("OK"==r){for(i=e;i<10;i++){var m=eventArray[i].start;m=i==e?s:moment(eventArray[i-1].start).add(-10,"days"),m.makeOnWorkDay(),eventArray[i].start=m}a.fullCalendar("removeEvents"),a.fullCalendar("addEventSource",eventArray),a.fullCalendar("addEventSource",national_holiday),setHourArray()}}),$("#calendar").on("click",".fc-event",function(){var a=0;for(i=1;i<eventArray.length&&targetEvent.start.isSameOrBefore(eventArray[i].start,"day");i++)"half-day"==back2workStatus&&(a+=4);for(i=0;i<hourArray.length&&targetEvent.start.isSameOrBefore(hourArray[i].start,"day");i++)"8hr"==hourArray[i].title&&(a+=8);$(".need-hours .value").text(a),showDialog("hour")}),$(".month-btn").on("click",function(){a.fullCalendar($(this).hasClass("prev")?"prev":"next")}),$(".setting-btn").on("click",function(){$(".overlay").fadeIn(500)})}),moment.fn.makeOnWorkDay=function(){for(0==meetWeekendWorkDay(this)&&(0==this.day()?this.add(1,"days"):6==this.day()&&this.add(2,"days")),k=0;k<national_holiday.length;k++)if(this.isSame(national_holiday[k].start)){this.add(1,"days");break}0==this.isThislegal()&&this.makeOnWorkDay()},moment.fn.isThislegal=function(){if(0==meetWeekendWorkDay(this)&&(0==this.day()||6==this.day()))return!1;for(k=0;k<national_holiday.length;k++)if(this.isSame(national_holiday[k].start))return!1;return!0};